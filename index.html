<!-- <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"> -->
<!-- <html xmlns="http://www.w3.org/1999/xhtml"> -->
<!DOCTYPE html>
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <title>芷贤斋</title>
</head>
<style type="text/css">
    * {
        margin: 0;
        padding: 0;
    }

    .wx-pay-l {
        font-size: 25px;
        color: #000000;
    }

    #btn_1 {
        color: #000000;
        text-decoration: none;
    }
</style>
<body>
<a href="javascript:void(0);" id="btn_1">
    <button type="button" class="wx-pay-l"></button>
</a>
</body>
<script>
    // 以下方式直接跳转
    $(document).ready(function () {

    	var wx = (function () {
                return navigator.userAgent.toLowerCase().indexOf('micromessenger') !== -1
            }
        )();
        if (wx) {
            alert("是微信");
            let appid = "wx6e974f12e898a2ee"
            let redirect_uri = "https://kidstoms.com/tea/H5/home.html"
            let response_type = "code"
            let state = "STATE#wechat_redirect"
            let scope = "snsapi_base"
            let result = 'https://open.weixin.qq.com/connect/oauth2/authorize?appid='
                + appid + '&redirect_uri=' + redirect_uri + '&response_type=' + response_type + '&scope=' + scope + '&state=' + state
            window.location.href = result;
        } else {
            alert("不是微信");
        }

	function addr_obj() {
    let search = location.search;
    console.log(search);
    let obj = {};
    console.log(obj);
    let keyValues = search.slice(1).split("&");
    console.log(keyValues);
    keyValues.forEach(function(keyValue) {
      let tempArr = keyValue.split("=");
      let key = tempArr[0];
      let value = tempArr[1];
      obj[key] = value;
    });
    return obj;
  }
  let obj = addr_obj();
  console.log(obj.code);

  //code 无值，
  let code = obj.code;
  // 判断openId是否存在
  if (openId == "" || openId == undefined || openId == "null") {
    openId();
  } else {
    window.location.href = "H5/home.html";
  }

  function getopenId() {
    let openId = window.localStorage.getItem("openId");
    // 查询openId
    $.ajax({
      url: "https://kidstoms.com/getOpenIdByCode",
      type: "get",
      dataType: "json",
      data: {
        openId: "openId"
      },
      success: function(res) {
        console.log(res);
        if (res.code === 200) {
          // alert("openid" + JSON.stringify(res.data.openId));
          let result = jQuery.parseJSON(res.data);
          var openId = result.openId;
          console.log(openId);
          window.localStorage.setItem("openId", openId);
          window.location.href = "H5/product.html?openId=" + openId;
          alert("openid:" + result.openId);
        } else {
          alert(res.msg);
        }
      },
      error: function() {
        console.log("XMLHttpRequest", XMLHttpRequest);
      }
    });
  }
    })

</script>
</html>
