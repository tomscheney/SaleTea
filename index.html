<!-- <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"> -->
<!-- <html xmlns="http://www.w3.org/1999/xhtml"> -->
<!DOCTYPE html>
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!--<meta http-equiv="refresh" content="0;url=H5/product.html">-->
	<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
	<title>芷贤斋</title>
</head>
<style type="text/css">
	* {
		margin: 0;
		padding: 0;
	}

	.wx-pay-l {
		font-size: 25px;
		color: #000000;
	}

	#btn_1 {
		color: #000000;
		text-decoration: none;
	}
</style>
<body>
	<a href="javascript:void(0);" id="btn_1"><button type="button" class="wx-pay-l"></button></a>
</body>
<script>
	// 以下方式直接跳转
	
	$(document).ready(function(){
		// 获取地址栏中的字符串，并将其转化为对象
		function addr_obj() {
		 var search = location.search;
		 var obj = {};
		 var keyValues = search.slice(1).split("&");
		 keyValues.forEach(function(keyValue) {
		  var tempArr = keyValue.split("=");
		  var key = tempArr[0];
		  // var value = tempArr[1].indexOf("|") > 0 ? tempArr[1].split("|") : tempArr[1];
		  var value = tempArr[1];
		  obj[key] = value;
		 });
		 return obj;
		}
		var obj = addr_obj()
		 console.log(obj.code)
		if(obj.code == ''|| obj.code == undefined || obj.code == 'null') {
			console.log("123")
			var appid = "wx3837a50ccd30cf87"
			var redirect_uri = "https://kidstoms.com/tea/index.html"
			var response_type = "code"
			var state = "STATE#wechat_redirect"
			var scope = "snsapi_base"
			var result = 'https://open.weixin.qq.com/connect/oauth2/authorize?appid=' 
				+ appid + '&redirect_uri='+redirect_uri+'&response_type='+code+'&scope='+scope+'&state='+state
			window.location.href=result;
		}
		console.log(obj.code)
		
	$.ajax({
		url: "https://kidstoms.com/getOpenIdByCode",
		type: "get",
		dataType: "json",
		data: {
			"code":obj.code,
		},
		success: function(res) {
			if (res.code === 200) {
				alert("openid" + res.data.openId)
				// Window.location.href=""
				$("#btn_1").text(res.data.openId);
			} else {
				alert(res.msg);
			}
		},
		error: function(XMLHttpRequest) {
			alert(textStatus)
			console.log("XMLHttpRequest", XMLHttpRequest)
			alert(JSON.stringify(XMLHttpRequest))
			alert(JSON.stringify(errorThrown))
			$(".wx-pay-l").text(JSON.stringify(textStatus));
			$(".wx-pay-l").text(textStatus, XMLHttpRequest, errorThrown);
		}
	})
})
</script>
</html>
