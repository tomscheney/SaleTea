<!-- <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"> -->
<!-- <html xmlns="http://www.w3.org/1999/xhtml"> -->
<!DOCTYPE html>
<head>
	<meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0">
	<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
	<title>芷贤斋</title>
</head>
<style type="text/css">
	* {
		margin: 0;
		padding: 0;
	}

	.wx-pay-l {
		font-size: 25px;
		color: #000000;
	}

	#btn_1 {
		color: #000000;
		text-decoration: none;
	}
</style>
<body>
	<a href="javascript:void(0);" id="btn_1"><button type="button" class="wx-pay-l"></button></a>
</body>
<script>
	// 以下方式直接跳转
	$(document).ready(function(){
<!--       如果是微信站外，直接跳转               -->
                      if (typeof WeixinJSBridge == "undefined") {
                      window.location.href="H5/product.html";
                      return;
                      }
                      
		function isWeiXin() {
		    var ua = window.navigator.userAgent.toLowerCase();
		    console.log(ua);//mozilla/5.0 (iphone; cpu iphone os 9_1 like mac os x) applewebkit/601.1.46 (khtml, like gecko)version/9.0 mobile/13b143 safari/601.1
		    if (ua.match(/MicroMessenger/i) == 'micromessenger') {
		        return true;
		    }
		    else {

		        return false;
		    }
		}
		if(isWeiXin()){
		    console.log("是来自微信内置浏览器");
		}
		else{
		    console.log("不是来自微信内置浏览器");
                
		}
		// 获取地址栏中的字符串，并将其转化为对象
		function addr_obj() {
		 var search = location.search;
		 var obj = {};
		 var keyValues = search.slice(1).split("&");
		 keyValues.forEach(function(keyValue) {
		  var tempArr = keyValue.split("=");
		  var key = tempArr[0];
		  // var value = tempArr[1].indexOf("|") > 0 ? tempArr[1].split("|") : tempArr[1];
		  var value = tempArr[1];
		  obj[key] = value;
		 });
		 return obj;
		}
		var obj = addr_obj()
		 console.log(obj.code)
		if(obj.code == ''|| obj.code == undefined || obj.code == 'null') {
			console.log("123")
			var appid = "wx6e974f12e898a2ee"
			var redirect_uri = "https://kidstoms.com/tea/index.html"
			var response_type = "code"
			var state = "STATE#wechat_redirect"
			var scope = "snsapi_base"
			var result = 'https://open.weixin.qq.com/connect/oauth2/authorize?appid='
				+ appid + '&redirect_uri='+redirect_uri+'&response_type='+response_type+'&scope='+scope+'&state='+state
			window.location.href=result;
		}
		console.log(obj.code)
		var code = obj.code;
	$.ajax({
		url: "https://kidstoms.com/getOpenIdByCode",
		type: "get",
		dataType: "json",
		data: {
			"code":code,
		},
		success: function(res) {
			if (res.code === 200) {
				alert("openid" + res.data.openId)
				// Window.location.href=""
			} else {
				alert(res.msg);
			}
		},
		error: function(XMLHttpRequest) {
			alert(textStatus)
			console.log("XMLHttpRequest", XMLHttpRequest)
			alert(JSON.stringify(XMLHttpRequest))
			alert(JSON.stringify(errorThrown))
			$(".wx-pay-l").text(JSON.stringify(textStatus));
			$(".wx-pay-l").text(textStatus, XMLHttpRequest, errorThrown);
		}
	})
})
</script>
</html>
