<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<script src="js/jquery-3.3.1.js"></script>
		<script src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title></title>
	</head>
	<body>
	</body>
	<script type="text/javascript">
		$('.wx-pay-btn').on('click',function(){
		    var data = {
		        "service":"match"
		        ,"method":"onlinePay"
		        , "token":localStorage.token
		        ,params:{
		            "payway":"1",
		            "paytyle":"match",
		            "matchId":waitPayObj.params.matchId,
		            "orderId":waitPayObj.params.orderId
		        }
		    };
		
		    $.ajax({
		        url: configUrl+'/api/index',
		        type: 'POST',
		        dataType: 'json',
		        async:false,
		        data: 'bodys='+JSON.stringify(data),
		        success: function (e) {
		            if(e.success){
		                // 微信支付的这些参数都是通过自己公司后台的接口拿到的哦
		                
		                var appId = e.params.payInfo.appId;
		                var timeStamp = e.params.payInfo.timeStamp;
		                var nonceStr = e.params.payInfo.nonceStr;
		                var package = e.params.payInfo.package;
		                var signType = e.params.payInfo.signType;
		                var paySign = e.params.payInfo.paySign;
		                // 调用微信jssdk支付
		                wx.config({
		                    debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
		                    appId: appId, // 必填，公众号的唯一标识
		                    timestamp: timeStamp, // 必填，生成签名的时间戳
		                    nonceStr: nonceStr, // 必填，生成签名的随机串
		                    signature: signType,// 必填，签名，见附录1
		                    jsApiList: ['chooseWXPay'] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
		                });
		
		                wx.chooseWXPay({
		                    appId:appId,     //公众号名称，由商户传入
		                    timestamp:timeStamp,         //时间戳，自1970年以来的秒数
		                    nonceStr:nonceStr, //随机串
		                    package:package,
		                    signType:signType,         //微信签名方式：
		                    paySign:paySign, //微信签名
		                    success: function (res) {
		                        // 支付成功后的回调函数
		                        setTimeout(function () {
		                            // 支付成功后跳转到订单页面
		                            window.location.href = '';
		                        },1000);
		                    }
		                });
		
		            }else{
		                layer.open({
		                    content: e.resultMsg
		                    ,skin: 'msg'
		                    ,time: 2 //2秒后自动关闭
		                });
		            }
		
		        },
		        error: function (e) {
		            layer.open({
		                content: e.resultMsg
		                ,skin: 'msg'
		                ,time: 2 //2秒后自动关闭
		            });
		        }
		    })
		});
	</script>
</html>
